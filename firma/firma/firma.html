<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Firma</title>
</head>
<body>
        <canvas class="firma" id="signature-pad" width="400" height="200"></canvas>
        <button class="firma_button" id="button">Convertir a imagen</button>
        <button class="firma_button" id="button_clear">Borrar Firma</button>
        <img id="signature-image" src="">
        <script>

            /* logica para dibujar la firma  con mouse*/
            var canvas = document.getElementById("signature-pad");
            var ctx = canvas.getContext("2d");

            var boton = document.querySelector('#button')
            var button_clear = document.querySelector('#button_clear');


            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = 2;
            ctx.strokeStyle = "black";
          
            canvas.addEventListener("mousedown", function (e) {
              ctx.beginPath();
              ctx.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
              canvas.addEventListener("mousemove", draw);
            });
          
            canvas.addEventListener("mouseup", function () {
              canvas.removeEventListener("mousemove", draw);
            });
          
            
            /* Logica para dibujar la firma en dispositivos touch */

            canvas.addEventListener("touchstart", function(e) {
                var touch = e.touches[0];
                var mouseEvent = new MouseEvent("mousedown", {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }, false);

            canvas.addEventListener("touchend", function(e) {
                var mouseEvent = new MouseEvent("mouseup", {});
                canvas.dispatchEvent(mouseEvent);
            }, false);

            canvas.addEventListener("touchmove", function(e) {
                e.preventDefault();
                var touch = e.touches[0];
                var mouseEvent = new MouseEvent("mousemove", {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }, false);

            function draw(e) {
              ctx.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
              ctx.stroke();
            }
            

            /* logica para exportar la firma */

            boton.onclick = () => {
              console.log("impreso")

              //Convertir la firma a imagen y colocarla en el dom
              /*
              var image = canvas.toDataURL();
              document.getElementById("signature-image").src = image;
              */

              //Convertir firma a imagen y descargar la imagen
              var img = canvas.toDataURL("image/png");
              var link = document.createElement("a");
              link.download = "miFirma.png";
              link.href = img;
              link.click();

              //enviar la frima por fetch
              var formData = new FormData();
              // formData.append("signature", img);

              // fetch("/upload", {
              //   method: "POST",
              //   body: formData
              // })
              // .then(response => response.text())
              // .then(result => {
              //   console.log(result);
              // })
              // .catch(error => {
              //   console.log("Error: ", error);
              // });

            };

            button_clear.onclick = () => {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
            };
        </script>
          <!-- En este ejemplo, se crea un canvas con un tamaño específico y se dibuja una línea negra cuando el usuario mueve el cursor sobre el canvas mientras mantiene presionado el botón del mouse.
          
          Existen varias librerías javascript para manejar la firma en canvas como signature_pad, signature_pad_2, etc. -->
          
          
</body>
</html>